#!/usr/bin/make -f

export DH_VERBOSE = 1
export PYBUILD_NAME = nuitka

# This disables the building with debug Python, not sure why we need to
# set PYBUILD_VERSIONS too, but it seemed that way.
export PYBUILD_INTERPRETERS = python{version}
# export PYBUILD_VERSIONS = $(shell pyversions -vr) $(shell py3versions -vr)

%:
	set -x

	# Do not use Python2 for Debian 11 or higher, need to find a way for Ubuntu
	# to cover.
	if [ "`lsb_release -r | sed -e s/Release://`" -ge 11 -a "`lsb_release -i| sed -e 's/Distributor ID:.//'`" = "Debian" ]
	then
		dh $@ --with python3 --buildsystem=pybuild
	else
		dh $@ --with python2,python3 --buildsystem=pybuild
	fi

override_dh_auto_build:
	cp Changelog.rst changelog
	cp Developer_Manual.rst Developer_Manual.txt

override_dh_auto_test:
	./tests/run-tests --skip-reflection-test
